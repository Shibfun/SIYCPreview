<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shiba Inu Yacht Club - TokenURI Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <style>
        body { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            font-family: 'Montserrat', Arial, sans-serif; 
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d); 
            margin: 0; 
            padding: 20px; 
            min-height: 100vh; 
            color: #fff; 
        }
        .header { 
            text-align: center; 
            margin-bottom: 20px; 
        }
        h1 { 
            font-size: 48px; 
            color: #ff8c00; 
            text-shadow: 0 0 10px rgba(255, 140, 0, 0.5); 
        }
        .wallet-info { 
            margin: 10px 0; 
            font-size: 16px; 
        }
        .action-buttons { 
            display: flex; 
            gap: 15px; 
            margin: 20px 0; 
        }
        .action-btn { 
            padding: 10px 20px; 
            font-size: 16px; 
            background: linear-gradient(45deg, #ff8c00, #e07b00); 
            color: #1a1a1a; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s; 
        }
        .action-btn:hover { 
            transform: scale(1.05); 
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.7); 
        }
        .action-btn:disabled { 
            background: #666; 
            cursor: not-allowed; 
        }
        .action-btn.loading { 
            opacity: 0.7; 
            pointer-events: none; 
        }
        .modal { 
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0, 0, 0, 0.8); 
            justify-content: center; 
            align-items: center; 
        }
        .modal-content { 
            background: #2d2d2d; 
            padding: 20px; 
            border-radius: 15px; 
            text-align: center; 
            color: #fff; 
            max-width: 350px; 
            border: 2px solid #ff8c00; 
            box-shadow: 0 0 20px rgba(255, 140, 0, 0.5); 
        }
        .modal-content p { 
            margin-bottom: 15px; 
            font-size: 18px; 
        }
        .modal-content button { 
            padding: 10px 20px; 
            background: #ff8c00; 
            color: #1a1a1a; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
        }
        .token-uri-section { 
            margin-top: 30px; 
            width: 100%; 
            max-width: 800px; 
            text-align: center; 
        }
        .token-uri-section h2 { 
            font-size: 32px; 
            color: #ff8c00; 
        }
        .input-group { 
            margin: 10px 0; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 10px; 
        }
        .input-group label { 
            font-size: 16px; 
            color: #ff8c00; 
        }
        .input-group input, .input-group textarea { 
            width: 100%; 
            max-width: 600px; 
            padding: 8px; 
            border-radius: 5px; 
            border: 1px solid #ff8c00; 
            background: #333; 
            color: #fff; 
            font-size: 14px; 
        }
        .input-group textarea { 
            height: 100px; 
            resize: vertical; 
        }
        #tokenURIOutput, #attributesOutput { 
            font-size: 14px; 
            color: #fff; 
            background: #333; 
            padding: 10px; 
            border-radius: 5px; 
            max-height: 300px; 
            overflow-y: auto; 
            word-wrap: break-word; 
            width: 100%; 
            max-width: 600px; 
            margin-top: 10px; 
        }
        .attribute-list { 
            text-align: left; 
            font-size: 14px; 
        }
        .attribute-item { 
            margin: 5px 0; 
        }
        .metadata-editor { 
            margin-top: 20px; 
        }
        .metadata-editor input, .metadata-editor textarea { 
            margin-bottom: 10px; 
        }
        @media (max-width: 768px) {
            h1 { font-size: 32px; }
            .wallet-info { font-size: 14px; }
            .action-btn { padding: 8px 16px; font-size: 14px; }
            .modal-content { max-width: 90%; padding: 15px; }
            .token-uri-section h2 { font-size: 24px; }
            .input-group label { font-size: 14px; }
            .input-group input, .input-group textarea { font-size: 12px; }
            #tokenURIOutput, #attributesOutput { font-size: 12px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Shiba Inu Yacht Club - TokenURI Manager</h1>
        <div class="wallet-info">
            Wallet: <span id="walletAddress">Not connected</span>
        </div>
        <button id="connectWalletBtn" class="action-btn">Connect Wallet</button>
    </div>
    <div class="token-uri-section">
        <h2>Query TokenURI & Attributes</h2>
        <div class="input-group">
            <label for="tokenIdInput">NFT Token ID:</label>
            <input type="number" id="tokenIdInput" min="1" placeholder="Enter Token ID">
            <button id="queryTokenURIBtn" class="action-btn" onclick="queryTokenURI()">Query TokenURI</button>
        </div>
        <div id="tokenURIOutput">TokenURI will appear here after querying.</div>
        <div id="attributesOutput">Attributes will appear here after querying.</div>
    </div>
    <div class="token-uri-section">
        <h2>Update TokenURI (Owner Only)</h2>
        <div class="input-group">
            <label for="updateTokenIdInput">NFT Token ID:</label>
            <input type="number" id="updateTokenIdInput" min="1" placeholder="Enter Token ID">
            <div class="metadata-editor">
                <label for="metadataName">NFT Name:</label>
                <input type="text" id="metadataName" placeholder="Enter NFT Name">
                <label for="metadataDescription">Description:</label>
                <textarea id="metadataDescription" placeholder="Enter Description"></textarea>
                <label for="metadataImage">Image URI:</label>
                <input type="text" id="metadataImage" placeholder="Enter Image URI (e.g., data:image/png;base64,...)">
                <label>Attributes:</label>
                <div id="attributesEditor" class="attribute-list"></div>
                <button class="action-btn" onclick="addAttributeField()">Add Attribute</button>
            </div>
            <button id="updateTokenURIBtn" class="action-btn" onclick="updateTokenURI()" disabled>Update TokenURI</button>
        </div>
    </div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <p id="modalMessage"></p>
            <button onclick="closeModal()">OK</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <script>
        let web3, accounts, contract;
        let currentMetadata = null;
        const CONTRACT_ADDRESS = "0xB33012feB12D590f4ee9B0D9999e95C30303A209";
        const CONTRACT_ABI = [
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    }
                ],
                "name": "tokenURI",
                "outputs": [
                    {
                        "internalType": "string",
                        "name": "",
                        "type": "string"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "uint256",
                        "name": "tokenId",
                        "type": "uint256"
                    },
                    {
                        "internalType": "string",
                        "name": "newTokenURI",
                        "type": "string"
                    }
                ],
                "name": "updateTokenMetadata",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "owner",
                "outputs": [
                    {
                        "internalType": "address",
                        "name": "",
                        "type": "address"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        const shibariumMainnet = {
            chainId: '0x6d',
            chainName: 'Shibarium',
            nativeCurrency: {
                name: 'BONE',
                symbol: 'BONE',
                decimals: 18
            },
            rpcUrls: ['https://www.shibrpc.com'],
            blockExplorerUrls: ['https://shibariumscan.io']
        };

        function showModal(message) {
            document.getElementById('modalMessage').innerHTML = message;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        async function connectWallet() {
            const connectButton = document.getElementById('connectWalletBtn');
            connectButton.classList.add('loading');
            if (!window.ethereum) {
                showModal('No wallet detected. Please install <a href="https://metamask.io" target="_blank">MetaMask</a>.');
                connectButton.classList.remove('loading');
                return;
            }
            try {
                web3 = new Web3(window.ethereum);
                accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                const chainId = await window.ethereum.request({ method: 'eth_chainId' });
                if (chainId !== '0x6d') {
                    try {
                        await window.ethereum.request({
                            method: 'wallet_switchEthereumChain',
                            params: [{ chainId: '0x6d' }],
                        });
                    } catch (switchError) {
                        if (switchError.code === 4902) {
                            await window.ethereum.request({
                                method: 'wallet_addEthereumChain',
                                params: [shibariumMainnet],
                            });
                        } else {
                            throw switchError;
                        }
                    }
                }
                contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
                showModal('Connected to Shibarium successfully!');
                updateWalletAddress();
                await checkOwnerStatus();
            } catch (error) {
                showModal('Connection failed: ' + error.message);
            } finally {
                connectButton.classList.remove('loading');
            }
        }

        async function updateWalletAddress() {
            if (!accounts || accounts.length === 0) {
                document.getElementById('walletAddress').innerText = 'Not connected';
            } else {
                const shortAddress = `${accounts[0].slice(0, 6)}...${accounts[0].slice(-4)}`;
                document.getElementById('walletAddress').innerText = shortAddress;
            }
        }

        async function checkOwnerStatus() {
            if (!contract || !accounts) return;
            try {
                const owner = await contract.methods.owner().call();
                if (accounts[0].toLowerCase() === owner.toLowerCase()) {
                    document.getElementById('updateTokenURIBtn').disabled = false;
                } else {
                    document.getElementById('updateTokenURIBtn').disabled = true;
                    showModal('Only the contract owner can update TokenURI.');
                }
            } catch (error) {
                showModal('Failed to check owner status: ' + error.message);
            }
        }

        async function queryTokenURI() {
            if (!web3 || !contract || !accounts) {
                showModal('Please connect your wallet first!');
                return;
            }
            const tokenId = document.getElementById('tokenIdInput').value;
            if (!tokenId || tokenId < 1) {
                showModal('Please enter a valid Token ID.');
                return;
            }
            const queryButton = document.getElementById('queryTokenURIBtn');
            queryButton.classList.add('loading');
            try {
                const tokenURI = await contract.methods.tokenURI(tokenId).call();
                document.getElementById('tokenURIOutput').innerText = tokenURI;
                let metadata = { attributes: [] };
                if (tokenURI.startsWith('data:application/json;base64,')) {
                    const base64Data = tokenURI.split(',')[1];
                    metadata = JSON.parse(atob(base64Data));
                    currentMetadata = metadata;
                }
                displayAttributes(metadata.attributes);
                populateMetadataEditor(metadata);
            } catch (error) {
                showModal('Failed to query TokenURI: ' + error.message);
                document.getElementById('tokenURIOutput').innerText = 'Error fetching TokenURI.';
                document.getElementById('attributesOutput').innerText = 'No attributes available.';
            } finally {
                queryButton.classList.remove('loading');
            }
        }

        function displayAttributes(attributes) {
            const attributesOutput = document.getElementById('attributesOutput');
            if (!attributes || attributes.length === 0) {
                attributesOutput.innerText = 'No attributes found.';
                return;
            }
            attributesOutput.innerHTML = '<h3>Attributes:</h3><div class="attribute-list"></div>';
            const attributeList = attributesOutput.querySelector('.attribute-list');
            attributes.forEach(attr => {
                const attrItem = document.createElement('div');
                attrItem.className = 'attribute-item';
                attrItem.innerText = `Trait: ${attr.trait_type}, Value: ${attr.value}`;
                attributeList.appendChild(attrItem);
            });
        }

        function populateMetadataEditor(metadata) {
            document.getElementById('metadataName').value = metadata.name || '';
            document.getElementById('metadataDescription').value = metadata.description || '';
            document.getElementById('metadataImage').value = metadata.image || '';
            const attributesEditor = document.getElementById('attributesEditor');
            attributesEditor.innerHTML = '';
            (metadata.attributes || []).forEach((attr, index) => {
                addAttributeField(attr.trait_type, attr.value);
            });
        }

        function addAttributeField(trait_type = '', value = '') {
            const attributesEditor = document.getElementById('attributesEditor');
            const attrDiv = document.createElement('div');
            attrDiv.className = 'attribute-item';
            attrDiv.innerHTML = `
                <input type="text" class="trait-type" placeholder="Trait Type (e.g., Background)" value="${trait_type}">
                <input type="text" class="trait-value" placeholder="Value (e.g., Aquamarine)" value="${value}">
                <button class="action-btn" onclick="this.parentElement.remove()">Remove</button>
            `;
            attributesEditor.appendChild(attrDiv);
        }

        async function updateTokenURI() {
            if (!web3 || !contract || !accounts) {
                showModal('Please connect your wallet first!');
                return;
            }
            const tokenId = document.getElementById('updateTokenIdInput').value;
            if (!tokenId || tokenId < 1) {
                showModal('Please enter a valid Token ID.');
                return;
            }
            const updateButton = document.getElementById('updateTokenURIBtn');
            updateButton.classList.add('loading');
            try {
                const metadata = {
                    name: document.getElementById('metadataName').value,
                    description: document.getElementById('metadataDescription').value,
                    image: document.getElementById('metadataImage').value,
                    attributes: []
                };
                const attributeItems = document.getElementById('attributesEditor').querySelectorAll('.attribute-item');
                attributeItems.forEach(item => {
                    const traitType = item.querySelector('.trait-type').value;
                    const traitValue = item.querySelector('.trait-value').value;
                    if (traitType && traitValue) {
                        metadata.attributes.push({ trait_type: traitType, value: traitValue });
                    }
                });
                const tokenURI = `data:application/json;base64,${btoa(JSON.stringify(metadata))}`;
                await contract.methods.updateTokenMetadata(tokenId, tokenURI).send({ from: accounts[0] });
                showModal('TokenURI updated successfully!');
                document.getElementById('tokenURIOutput').innerText = tokenURI;
                displayAttributes(metadata.attributes);
            } catch (error) {
                showModal('Failed to update TokenURI: ' + error.message);
            } finally {
                updateButton.classList.remove('loading');
            }
        }

        window.onload = () => {
            if (!window.ethereum) {
                showModal('No wallet detected. Please install <a href="https://metamask.io" target="_blank">MetaMask</a>.');
            }
        };

        window.ethereum?.on('chainChanged', () => {
            window.location.reload();
        });

        window.ethereum?.on('accountsChanged', (newAccounts) => {
            accounts = newAccounts;
            updateWalletAddress();
            checkOwnerStatus();
        });

        document.getElementById('connectWalletBtn').addEventListener('click', connectWallet);
    </script>
</body>
</html>
